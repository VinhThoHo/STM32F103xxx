#include "button.h"
#include "u8g2.h"

extern u8g2_t u8g2;
uint32_t t, x;
uint8_t key = 0;
const unsigned char Fan [] = {
0x00, 0x00, 0x00, 0x7F, 0xFE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xFF, 0xF0, 0x00, 0x00,
0x00, 0x00, 0x7F, 0xC0, 0x03, 0xFE, 0x00, 0x00, 0x00, 0x01, 0xFC, 0x00, 0x00, 0x3F, 0x80, 0x00,
0x00, 0x07, 0xE1, 0xFF, 0x00, 0x07, 0xE0, 0x00, 0x00, 0x0F, 0x83, 0xFF, 0x80, 0x01, 0xF0, 0x00,
0x00, 0x1E, 0x07, 0xFF, 0xC0, 0x00, 0x78, 0x00, 0x00, 0x3C, 0x03, 0xFF, 0xC0, 0x00, 0x3C, 0x00,
0x00, 0x78, 0x01, 0xFF, 0xE0, 0x00, 0x1E, 0x00, 0x00, 0xF8, 0x00, 0x1F, 0xE0, 0x00, 0x1F, 0x00,
0x00, 0xF0, 0x00, 0x0C, 0x00, 0xFF, 0x0F, 0x00, 0x00, 0xF0, 0x00, 0x03, 0xCF, 0xFF, 0x8F, 0x00,
0x00, 0xF0, 0x00, 0x73, 0xCF, 0xFF, 0xCF, 0x00, 0x00, 0xF0, 0x03, 0xF8, 0x3F, 0xFF, 0xCF, 0x00,
0x00, 0xF8, 0x07, 0xFE, 0x1F, 0xFF, 0x9F, 0x00, 0x00, 0x78, 0x1F, 0xFC, 0x00, 0xFC, 0x1E, 0x00,
0x00, 0x3C, 0x1F, 0xFC, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x1E, 0x1F, 0xFC, 0x00, 0x00, 0x78, 0x00,
0x00, 0x0F, 0x8F, 0xF8, 0x00, 0x01, 0xF0, 0x00, 0x00, 0x07, 0xE3, 0xE0, 0x00, 0x07, 0xE0, 0x00,
0x00, 0x01, 0xFC, 0x00, 0x00, 0x3F, 0x80, 0x00, 0x00, 0x00, 0x7F, 0xC0, 0x03, 0xFE, 0x00, 0x00,
0x00, 0x00, 0x0F, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0xFE, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0xFC, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x7F, 0xFE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00,
0x00, 0x00, 0x01, 0xFF, 0xFF, 0x80, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00,
0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00
};



void button_init(void)
{
  GPIO_InitTypeDef GPIO_InitStruct = {0};

  /* GPIO Ports Clock Enable */
  __HAL_RCC_GPIOC_CLK_ENABLE();

  /*Configure GPIO pins : PC13 PC10 PC11 PC12 */
  GPIO_InitStruct.Pin = GPIO_PIN_13|GPIO_PIN_10|GPIO_PIN_11|GPIO_PIN_12;
  GPIO_InitStruct.Mode = GPIO_MODE_INPUT;
  GPIO_InitStruct.Pull = GPIO_PULLUP;
  HAL_GPIO_Init(GPIOC, &GPIO_InitStruct);
  t = HAL_GetTick();
  x = HAL_GetTick();
}

uint8_t get_button(void)
{
  if(key1 == 0)
    return 1;
  else if(key2 == 0)
    return 2;
  else if(key3 ==0)
    return 3;
  else if(key4 == 0)
    return 4;
  else return 0;
}
void button_test(void)
{
  if(HAL_GetTick()-t >200)
  {
    key = get_button();
    switch(key)
    { 
      case 1:
        printf("Button 1 Press\n");
        break;
      case 2:
        printf("Button 2 Press\n");
        break;
      case 3:
        printf("Button 3 Press\n");
        break;
      case 4:
        printf("Button 4 Press\n");
        break;
    }
    t = HAL_GetTick();
  }
}
void menu(void)
{
  u8g2_ClearBuffer(&u8g2);
  u8g2_ClearDisplay(&u8g2);
  u8g2_SetFont(&u8g2, u8g2_font_6x10_tf);
  u8g2_SetFontRefHeightAll(&u8g2);   /* this will add some extra space for the text inside the buttons */
  u8g2_UserInterfaceMessage(&u8g2, "UV", "Light", "Fan", " Ok \n Cancel ");
  u8g2_SendBuffer(&u8g2);
}
void selection_menu(void)
{
  u8g2_ClearBuffer(&u8g2);
  u8g2_ClearDisplay(&u8g2);
  u8g2_SetFont(&u8g2, u8g2_font_6x10_tf);
  u8g2_SetFontRefHeightAll(&u8g2);
  u8g2_UserInterfaceSelectionList(&u8g2, "UV", 1, "On\nOff");
  u8g2_SendBuffer(&u8g2);
}
void Fan_key(void)
{
  u8g2_ClearBuffer(&u8g2);
  u8g2_ClearDisplay(&u8g2);
  u8g2_DrawBitmap(&u8g2, 32, 15, 8, 32, Fan);
  u8g2_SendBuffer(&u8g2);
}
void Clock_key(void)
{
  u8g2_ClearBuffer(&u8g2);
  u8g2_ClearDisplay(&u8g2);
  u8g2_SetFont(&u8g2, u8g2_font_unifont_t_symbols);
  u8g2_DrawGlyph(&u8g2, 5, 20, 0x23f1);
  u8g2_SendBuffer(&u8g2);
}
